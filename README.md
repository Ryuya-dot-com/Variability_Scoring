# Vocabulary Test Scorer

Barcroft & Sommers (2005) に基づく語彙産出テストの採点ツールです。参加者の音声録音を聴き、正確性（accuracy）と発話開始点（onset）を記録します。

---

## 目次

1. [概要](#概要)
2. [起動方法](#起動方法)
3. [セットアップ画面](#セットアップ画面)
4. [採点画面の見方](#採点画面の見方)
5. [採点の手順](#採点の手順)
6. [採点基準](#採点基準)
7. [発話開始点（onset）の確認](#発話開始点onsetの確認)
8. [波形の操作](#波形の操作)
9. [キーボードショートカット](#キーボードショートカット)
10. [データのエクスポート](#データのエクスポート)
11. [よくある質問](#よくある質問)

---

## 概要

このアプリは、スペイン語の語彙習得実験における参加者の回答を採点するために作られています。

### テストの種類

| テスト | 内容 | 参加者の回答言語 |
|--------|------|------------------|
| **L2-to-L1（翻訳）** | スペイン語の音声を聴き、英語に翻訳する | 英語 |
| **Picture Naming（命名）** | 画像を見て、スペイン語で名前を言う | スペイン語 |

### 実験条件

| 条件 | 説明 |
|------|------|
| **Immediate** | 学習直後のテスト |
| **Delayed** | 一定時間経過後のテスト |

これらの組み合わせで計 **4つのデータセット** があり、各参加者は **24試行** を行います。

---

## 起動方法

1. **Google Chrome** でアクセスしてください（推奨ブラウザ）
2. GitHub Pages の URL を開きます：
   `https://ryuya-dot-com.github.io/Variability_Scoring/`
3. 初回は音声データの読み込みに少し時間がかかることがあります

> **注意**: 採点データはブラウザの localStorage に保存されます。同じブラウザ・同じ端末でアクセスすれば、前回の続きから再開できます。シークレットモードでは保存されません。

---

## セットアップ画面

アプリを開くと、最初にセットアップ画面が表示されます。

### 1. Rater ID を入力

自分の識別名を入力します（例: `rater_A`）。エクスポートファイルにこの名前が記録されます。

### 2. データセットを選択

4つのデータセットから1つを選びます：

- Immediate / L2-to-L1
- Immediate / Picture Naming
- Delayed / L2-to-L1
- Delayed / Picture Naming

### 3. 参加者を選択

チェックボックスで採点する参加者を選びます。

- **Select All**: 全参加者を選択
- **Deselect All**: 全選択を解除

### 4. 採点を開始

**Start Scoring** ボタンを押すと、採点画面に進みます。

### 前回の続きから再開する場合

同じ Rater ID とデータセットを選択すると、画面下部に **Previous Session Found** と表示されます。**Resume** ボタンを押すと、前回の続きから再開できます。

---

## 採点画面の見方

採点画面は以下の要素で構成されています。

### ヘッダー

| 要素 | 説明 |
|------|------|
| **Back** | セットアップ画面に戻る |
| **データセット名** | 現在のデータセット（例: Immediate / L2-to-L1） |
| **← Prev / Next →** | 試行の前後移動 |
| **Prev P / Next P** | 参加者の前後移動 |

### 試行情報

- **対象の単語**（スペイン語）が大きく表示されます
- 正解の英単語と日本語訳が下に表示されます
- L2-to-L1 では声の種類（male / female）も表示されます
- Picture Naming では画像が表示されます

### 波形ビューア

音声の波形が表示されます。

- **赤い縦線** = 発話開始点（onset）。自動検出された位置が表示されます
- **緑の縦線** = 刺激音声の終了位置（L2-to-L1 テストのみ）。この線の後に参加者の回答が始まるはずです
- **ミニマップ**（下部）= 音声全体の概要

### 採点ボタン

4つのスコアボタンが並んでいます：

| ボタン | キー | 意味 |
|--------|------|------|
| **NR** | `9` | 無回答（発話なし） |
| **0** | `0` | 不正確 |
| **0.5** | `5` | 一部正確（1音節内の音素エラー） |
| **1** | `1` | 完全に正しい |

### プログレスバー

画面下部に採点の進捗が表示されます（例: 45 / 912 scored）。**Jump to Unscored** ボタンで未採点の試行に直接移動できます。

---

## 採点の手順

各試行で以下の手順を繰り返します。

### ステップ 1: 音声を再生する

`Space` キーまたは **Play** ボタンで音声を再生します。

- 再生速度を変更したい場合は、速度ドロップダウン（0.5x〜1.5x）を使います
- 聴き直したい場合は何度でも再生できます

### ステップ 2: 発話開始点（onset）を確認する

自動検出された onset（赤い線）が正しいかを確認し、以下のいずれかを選びます。

| ボタン | キー | いつ使うか |
|--------|------|------------|
| **Confirm** | `C` | 自動検出が正しい場合 |
| **Correct (drag)** | — | 赤い線をドラッグして位置を修正する場合 |
| **Manual Set** | — | 波形をクリックして手動で設定する場合 |
| **No Speech** | — | 発話が全くない場合 |

### ステップ 3: 正確性を採点する

参加者の回答を聴いて、スコアを付けます。

- **NR**（`9`キー）: 録音に発話が全く含まれていない
- **0**（`0`キー）: 発話はあるが、不正確
- **1**（`1`キー）: 完全に正しい回答
- **0.5**（`5`キー）: 一部だけ正確（詳しくは[採点基準](#採点基準)を参照）

> **ヒント**: NR を選択すると、onset は自動的に「No Speech」に設定されます。ステップ 2 を飛ばして直接 NR を押しても大丈夫です。

### ステップ 4: メモを入力する（任意）

必要に応じて `N` キーでノート欄にフォーカスし、メモを入力できます（例: 「ノイズが多い」「小声」など）。

### ステップ 5: 次の試行へ進む

`→` キーまたは `Enter` キーで次の試行に進みます。

> **自動保存**: スコアや onset を変更するたびに自動的に保存されます。手動での保存操作は不要です。

---

## 採点基準

### 1点 — 完全に正しい産出

全ての音素が正確に産出されている場合。

### 0.5点 — 1つの音節内で音素の欠落・不正確

1つの音節の中で音素が欠落しているか不正確だが、他の音節は正確な場合。

> **注意**: L2-to-L1 テストでは、参加者は英語で回答するため、0.5 はほとんど使われません。正しい英単語が産出されていれば 1 点としてください。

### 0点 — 不正確な産出

- 2つ以上の音節に誤りがある場合
- 全く異なる単語を産出した場合
- 発話はあるが正解と一致しない場合

### NR — 無回答（No Response）

録音に参加者の発話が全く含まれていない場合。

### 特殊ケース

- **manzana / lapiz**: "z" の発音について、/θ/（カスティーリャ方言）と /s/（ラテンアメリカ方言）の両方を正しいと見なします
- **L2-to-L1 テスト**: 音素レベルの採点（0.5）はほぼ適用されません。正しい英単語かどうかで 1 / 0 を判断してください

---

## 発話開始点（onset）の確認

### onset とは

onset は、参加者が発話を開始した瞬間（ミリ秒単位）です。この値を元にレイテンシ（反応時間）が計算されます。

### よくあるずれのパターン

| パターン | 原因 | 対処法 |
|----------|------|--------|
| **onset が早すぎる** | 環境ノイズやマイクのノイズが検出された | 波形で発話開始点を確認し、マーカーをドラッグして修正 |
| **onset が遅すぎる** | 小声での発話が検出されなかった | 波形をズームインして確認し、Manual Set で設定 |
| **息や舌打ちの誤検出** | 発話前の呼吸音やクリック音が検出された | 実際の発話開始点にマーカーを移動 |

### L2-to-L1 テストの場合

- **緑の線** = スペイン語の刺激音声が終わった位置
- **赤い線** = 参加者が英語で回答を開始した位置
- 通常、赤い線は緑の線の後にあるはずです

---

## 波形の操作

| 操作 | 方法 |
|------|------|
| **再生 / 一時停止** | `Space` キーまたは Play ボタン |
| **停止** | Stop ボタン |
| **onset 位置から再生** | `R` キー（onset の 200ms 前から再生） |
| **ズームイン** | `+` キーまたは Zoom In ボタン |
| **ズームアウト** | `-` キーまたは Zoom Out ボタン |
| **ズームリセット** | Fit ボタン（1.0x に戻す） |
| **再生速度の変更** | 速度ドロップダウン（0.5x / 0.75x / 1x / 1.25x / 1.5x） |
| **onset マーカーの移動** | 赤い線をドラッグ、または Manual Set モードで波形をクリック |
| **ミニマップ** | 波形下部の小さな波形で全体の位置を確認 |

---

## キーボードショートカット

`?` キーでショートカット一覧をいつでも表示できます。

| キー | 操作 |
|------|------|
| `Space` | 再生 / 一時停止 |
| `9` | スコア = NR（無回答） |
| `0` | スコア = 0（不正確） |
| `5` | スコア = 0.5（一部正確） |
| `1` | スコア = 1（正確） |
| `→` / `Enter` | 次の試行 |
| `←` | 前の試行 |
| `C` | onset を確認（Confirm） |
| `R` | onset 位置から再生 |
| `N` | メモ入力欄にフォーカス |
| `I` | 説明パネルの表示 / 非表示 |
| `+` | ズームイン |
| `-` | ズームアウト |
| `?` | ショートカット一覧の表示 / 非表示 |

> **効率的な採点フロー**: `Space`（再生）→ `C`（onset 確認）→ `1` or `0`（採点）→ `→`（次へ）の繰り返しで、キーボードだけで素早く採点できます。

---

## データのエクスポート

### 参加者ごとの Excel 出力

画面下部の **Export Participant (.xlsx)** ボタンで、現在表示中の参加者のデータを Excel ファイルとしてダウンロードします。

また、1人の参加者の全 24 試行を採点し終えると、自動的にダウンロードのポップアップが表示されます。

### 全参加者の一括 CSV 出力

**Export All (CSV)** ボタンで、選択した全参加者のデータを 1 つの CSV ファイルにまとめてダウンロードします。

### JSON 出力

**Export JSON** ボタンで、全ての採点データを JSON 形式でダウンロードします。バックアップとして利用できます。

### エクスポートに含まれる主な項目

| 列名 | 説明 |
|------|------|
| `rater_id` | 採点者 ID |
| `participant_id` | 参加者 ID |
| `trial` | 試行番号 |
| `word` | 対象の単語 |
| `accuracy_score` | 採点スコア（1, 0.5, 0, または NR） |
| `onset_ms_auto` | 自動検出された onset（ms） |
| `onset_ms_rater` | 採点者が設定した onset（ms） |
| `onset_status` | onset の確認状態（confirmed / corrected / manual / no_speech） |
| `latency_ms_auto` | 自動検出された反応時間（ms） |
| `latency_ms_rater` | 採点者の onset に基づく反応時間（ms） |
| `notes` | メモ |

---

## よくある質問

### Q: 前回の続きから始めるには？

同じ Rater ID とデータセットを選択すると、**Previous Session Found** が表示されます。**Resume** ボタンを押してください。

### Q: 採点を間違えた場合は？

そのまま該当の試行に戻って（`←` キーで前の試行へ）、スコアを上書きしてください。最新の値が自動的に保存されます。

### Q: 音声が再生されない場合は？

- ブラウザの音量がミュートになっていないか確認してください
- Chrome を使用しているか確認してください
- ページをリロードしてみてください

### Q: データが消えてしまった場合は？

- ブラウザの localStorage をクリアすると、採点データが削除されます
- シークレットモードではデータが保存されません
- 定期的に **Export JSON** でバックアップを取ることを推奨します

### Q: 別のデータセットに切り替えるには？

**Back** ボタンでセットアップ画面に戻り、新しいデータセットを選択してください。前のデータセットの採点データはそのまま保持されます。

### Q: 「説明」ボタンはどこ？

ヘッダー左側の **説明** ボタン、または `I` キーで採点基準の詳細を確認できます。
